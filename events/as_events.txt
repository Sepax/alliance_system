namespace = alliance_system
# Initialisation
country_event = {
	id = alliance_system.1
	title = alliance_system.1.t
	desc = alliance_system.1.d
	picture = RELIGION_eventPicture
	is_triggered_only = yes
	fire_only_once = yes
	hidden = yes
	mean_time_to_happen = {
		days = 1
	}
	trigger = {
		is_player = yes
	}
	option = {
		country_event = {
			id = alliance_system.2
		}
		every_country = {
            country_event = {
                id = alliance_system.3
            }
        }
	}
}

# Sets dev values and finds the top dev country
country_event = {
	id = alliance_system.2
	title = alliance_system.2.t
	desc = alliance_system.2.d
	picture = RELIGION_eventPicture
	hidden = yes
	mean_time_to_happen = {
		days = 1
	}
	trigger = {
		is_player = yes
		NOT = {
			1269 = {
				has_province_modifier = dev_list_timer
			}
		}
	}
	option = {
		hidden_effect = {
			set_dev_values = yes
			find_top_dev = yes
		}
		1269 = {
			add_province_modifier = {
				name = dev_list_timer
				duration = 30
			}
		}
	}
}

# Updates the alliance points of all countries
country_event = {
	id = alliance_system.3
	title = alliance_system.3.t
	desc = alliance_system.3.d
	picture = RELIGION_eventPicture
	hidden = yes
	mean_time_to_happen = {
		days = 1
	}
	trigger = {
		is_player = yes
		NOT = {
			has_country_modifier = alliance_scanner_timer
		}
	}
	option = {
		hidden_effect = {
			alliance_scanner = yes
		}
		add_country_modifier = {
			name = alliance_scanner_timer
			duration = 10 
			hidden = yes
		}
	}
}

# Too many alliances
country_event = {
	id = alliance_system.4
	title = alliance_system.4.t
	desc = alliance_system.4.d
	picture = RULEBREAK_eventPicture
	is_triggered_only = yes
	mean_time_to_happen = {
		days = 1
	}
	trigger = {
		is_player = yes
		has_country_flag = too_many_alliances
		NOT = {
			has_country_modifier = too_many_alliances_timer
		}
	}
	immediate {
		list_treaties = yes
	}
	option = {
		name = alliance_system.4.a
		trigger = {
			NOT = {
				has_country_flag = rechecked_alliances
			}
		}
		set_country_flag = rechecked_alliances
	}
	option = {
		name = alliance_system.4.b
		trigger = {
			NOT = {
				any_country = {
					has_breakable_treaty_flag = yes
				}
			}
		}
		every_country = {
			limit = {
				is_player = yes
				has_country_flag = alliance_notifications
				NOT = {
					tag = ROOT
				}
			}
			country_event = {
				id = alliance_system.5
			}
		}
	}
	option = {
		name = alliance_system.4.c
		trigger = {
			event_target:a1 = {
				has_breakable_treaty_flag = yes
			}
		}
		break_treaty = { who = event_target:a1 }
		clr_country_flag = rechecked_alliances
	}
	option = {
		name = alliance_system.4.d
		trigger = {
			event_target:a2 = {
				has_breakable_treaty_flag = yes
			}
		}
		break_treaty = { who = event_target:a2 }
		clr_country_flag = rechecked_alliances
	}
	option = {
		name = alliance_system.4.e
		trigger = {
			event_target:a3 = {
				has_breakable_treaty_flag = yes
			}
		}
		break_treaty = { who = event_target:a3 }
		clr_country_flag = rechecked_alliances
	}
	option = {
		name = alliance_system.4.f
		trigger = {
			event_target:a4 = {
				has_breakable_treaty_flag = yes
			}
		}
		break_treaty = { who = event_target:a4 }
		clr_country_flag = rechecked_alliances
	}
	option = {
		name = alliance_system.4.g
		trigger = {
			event_target:a5 = {
				has_breakable_treaty_flag = yes
			}
		}
		break_treaty = { who = event_target:a5 }
		clr_country_flag = rechecked_alliances
	}
	option = {
		name = alliance_system.4.h
		trigger = {
			event_target:a6 = {
				has_breakable_treaty_flag = yes
			}
		}
		break_treaty = { who = event_target:a6 }
		clr_country_flag = rechecked_alliances
	}
	option = {
		name = alliance_system.4.i
		trigger = {
			event_target:a7 = {
				has_breakable_treaty_flag = yes
			}
		}
		break_treaty = { who = event_target:a7 }
		clr_country_flag = rechecked_alliances
	}
	option = {
		name = alliance_system.4.j
		trigger = {
			event_target:a8 = {
				has_breakable_treaty_flag = yes
			}
		}
		break_treaty = { who = event_target:a8 }
		clr_country_flag = rechecked_alliances
	}
	option = {
		name = alliance_system.4.k
		trigger = {
			event_target:a9 = {
				has_breakable_treaty_flag = yes
			}
		}
		break_treaty = { who = event_target:a9 }
		clr_country_flag = rechecked_alliances
	}
	option = {
		name = alliance_system.4.l
		trigger = {
			event_target:a10 = {
				has_breakable_treaty_flag = yes
			}
		}
		break_treaty = { who = event_target:a10 }
		clr_country_flag = rechecked_alliances
	}

	after = {
		alliance_scanner = yes
		if = {
			limit = {
				NOT = {
					has_country_flag = rechecked_alliances
				}
			}
			add_country_modifier = {
				name = too_many_alliances_timer
				duration = 30
				hidden = yes
			}
		}
	}
}

# Too many alliances (notification)
country_event = {
	id = alliance_system.5
	title = alliance_system.5.t
	desc = alliance_system.5.d
	picture = southamericagfx_ANGRY_MOB_eventPicture
	is_triggered_only = yes
	trigger = {
		is_player = yes
		has_country_flag = alliance_notifications
	}
	option = {
		name = alliance_system.5.a
	}
}

# Decision switches
country_event = {
	id = alliance_system.6
	title = alliance_system.6.t
	desc = alliance_system.6.d
	picture = RELIGION_eventPicture
	hidden = yes
	is_triggered_only = yes
	mean_time_to_happen = {
		days = 1
	}
	trigger = {
		is_player = yes
	}
	option = {
		clr_country_flag = alliance_system_notify_switch
		clr_country_flag = alliance_system_switch
	}
}

# End guarantee with country (notification)
country_event = {
	id = alliance_system.7
	title = alliance_system.7.t
	desc = alliance_system.7.d
	picture = southamericagfx_ANGRY_MOB_eventPicture
	is_triggered_only = yes
	mean_time_to_happen = {
		days = 1
	}
	trigger = {
		is_player = yes
	}
	immediate = {
		# Notify everyone else
		every_country = {
			limit = {
				is_player = yes
				has_country_flag = alliance_notifications
				NOT = {
					tag = FROM
					tag = PREV
				}
			}
			country_event = {
				id = alliance_system.9
			}
		}
	}
	option = {
		name = alliance_system.7.a
	}
}

# Stop supporting independence of country (notification)
country_event = {
	id = alliance_system.8
	title = alliance_system.8.t
	desc = alliance_system.8.d
	picture = southamericagfx_ANGRY_MOB_eventPicture
	is_triggered_only = yes
	mean_time_to_happen = {
		days = 1
	}
	trigger = {
		is_player = yes
	}
	immediate = {
		# Notify everyone else
		every_country = {
			limit = {
				is_player = yes
				has_country_flag = alliance_notifications
				NOT = {
					tag = FROM
					tag = PREV
				}
			}
			country_event = {
				id = alliance_system.10
			}
		}
	}
	option = {
		name = alliance_system.8.a
	}
}

# A nation has recived a notification to end a guarantee (notification)
country_event = {
	id = alliance_system.9
	title = alliance_system.9.t
	desc = alliance_system.9.d
	picture = southamericagfx_ANGRY_MOB_eventPicture
	is_triggered_only = yes
	mean_time_to_happen = {
		days = 1
	}
	trigger = {
		is_player = yes
		has_country_flag = alliance_notifications
	}
	option = {
		name = alliance_system.9.a
	}
}

# A nation has recived a notification to end a support independence (notification)
country_event = {
	id = alliance_system.10
	title = alliance_system.10.t
	desc = alliance_system.10.d
	picture = southamericagfx_ANGRY_MOB_eventPicture
	is_triggered_only = yes
	mean_time_to_happen = {
		days = 1
	}
	trigger = {
		is_player = yes
		has_country_flag = alliance_notifications
	}
	option = {
		name = alliance_system.10.a
	}
}


